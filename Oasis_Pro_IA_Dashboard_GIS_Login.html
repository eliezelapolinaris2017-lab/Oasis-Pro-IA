<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OASIS PRO IA ‚Äî Panel</title>
<style>
  :root{
    --bg:#0b1624; --panel:#122033; --panel-2:#0f1b2b; --muted:#7f8aa3; --text:#e9eef8;
    --primary:#3aa0ff; --primary-2:#00c2ff; --accent:#2b6fff; --card-radius:14px; --shadow:0 10px 24px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background: radial-gradient(1200px 700px at -200px -100px, rgba(10,70,120,.25), transparent 70%), var(--bg); color:var(--text); }
  .app{display:grid; grid-template-columns:280px 1fr; min-height:100vh;}
  .sidebar{ background: linear-gradient(180deg, var(--panel-2), #0c1a2a 60%, #0a1626); padding:28px 22px; border-right:1px solid rgba(255,255,255,.06); }
  .brand{ display:flex; align-items:center; gap:12px; margin-bottom:26px;}
  .logo{ width:44px; height:44px; border-radius:12px; background: conic-gradient(from 60deg, #00c2ff, #1986ff, #00c2ff); position:relative; display:grid; place-items:center; box-shadow:0 8px 18px rgba(0,140,255,.35) inset, 0 0 0 1px rgba(255,255,255,.06);}
  .logo svg{width:28px; height:28px; filter:drop-shadow(0 2px 2px rgba(0,0,0,.25));}
  .brand h1{line-height:1; margin:0; font-size:18px; letter-spacing:.3px}
  .brand small{display:block; color:#c6d5ee; opacity:.85; margin-top:3px; font-weight:500}
  .nav a{ display:flex; align-items:center; gap:10px; padding:12px 12px; border-radius:10px; color:#c5d2ea; text-decoration:none; margin:6px 0; transition:transform .05s ease, background .2s ease, color .2s ease;}
  .nav a:hover{background:rgba(255,255,255,.06); color:#fff; transform:translateX(2px)}
  .nav a.active{background:linear-gradient(90deg, rgba(0,194,255,.18), rgba(25,134,255,.15)); color:#fff; box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}
  .sidebar-footer{margin-top:28px; font-size:12px; color:#9fb3d8}
  .toggle-menu{display:none; position:fixed; top:12px; left:12px; z-index:50; background:#0e1c2e; border:1px solid rgba(255,255,255,.12); color:#d8e6ff; border-radius:10px; padding:10px 12px; cursor:pointer}
  .main{padding:28px; display:grid; gap:22px;}
  .grid{display:grid; grid-template-columns:1.2fr .9fr; gap:22px;}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:22px;}
  .card{ background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00)), var(--panel); border-radius:var(--card-radius); padding:18px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,.06); }
  .card h3{margin:0 0 12px 0; font-size:18px; letter-spacing:.2px}
  .muted{color:var(--muted)}
  .input, select, textarea{ width:100%; padding:12px 14px; border-radius:12px; background:#0e1c2e; border:1px solid rgba(255,255,255,.08); color:var(--text); outline:none;}
  .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; background: linear-gradient(90deg, var(--primary), var(--primary-2)); border:none; color:#00122a; font-weight:700; padding:12px 16px; border-radius:12px; cursor:pointer; letter-spacing:.3px; box-shadow:0 8px 20px rgba(0,162,255,.35); }
  .btn.secondary{background:#0e1c2e; color:#d8e6ff; border:1px solid rgba(255,255,255,.08); box-shadow:none}
  .calendar{display:grid; gap:10px}
  .cal-header{display:flex; align-items:center; justify-content:space-between}
  .cal-grid{ display:grid; grid-template-columns:repeat(7, 1fr); gap:6px; }
  .cal-cell{ border-radius:10px; padding:8px; min-height:58px; background:#0e1b2b; border:1px solid rgba(255,255,255,.06); display:flex; flex-direction:column;}
  .cal-cell .day{font-size:12px; color:#9fb3d8}
  .cal-cell .dot{margin-top:auto; height:6px; width:6px; border-radius:50%; background:var(--primary)}
  .cal-cell.today{outline:2px solid var(--accent)}
  .list{display:grid; gap:10px; max-height:240px; overflow:auto}
  .item{ background:#0f1c2d; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:10px 12px; display:flex; justify-content:space-between; align-items:center; gap:8px}
  .kpis{display:flex; gap:14px; flex-wrap:wrap}
  .kpi{flex:1 1 120px; background:#0e1b2b; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:12px}
  canvas{width:100%; height:140px; display:block}
  .hidden{display:none !important}
  table{ width:100%; border-collapse:collapse;}
  th,td{ border-bottom:1px solid rgba(255,255,255,.07); padding:8px; text-align:left; }
  .t-right{text-align:right}
  @media (max-width: 1100px){ .app{grid-template-columns:1fr} .sidebar{display:none} .toggle-menu{display:block} .grid{grid-template-columns:1fr} .row{grid-template-columns:1fr} }
</style>
<!-- Google Identity Services (Login) -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
<button class="toggle-menu" id="toggleMenu">‚ò∞ Menu</button>
<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <div class="logo" aria-label="Oasis Pro IA">
        <svg viewBox="0 0 24 24" fill="#e9f7ff" aria-hidden="true">
          <path d="M12 2l1.2 2.9a7.7 7.7 0 013 .9l2.7-1.4 1.6 2.8-2.3 1.9a7.8 7.8 0 01.1 1.1 7.8 7.8 0 01-.1 1.1l2.3 1.9-1.6 2.8-2.7-1.4a7.7 7.7 0 01-3 .9L12 22l-1.2-2.9a7.7 7.7 0 01-3-.9l-2.7 1.4-1.6-2.8 2.3-1.9a7.8 7.8 0 01-.1-1.1 7.8 7.8 0 01.1-1.1L2.5 7.2l1.6-2.8 2.7 1.4a7.7 7.7 0 013-.9L12 2zm0 6.2a3.8 3.8 0 100 7.6 3.8 3.8 0 000-7.6z"/>
          <path fill="#0aa8ff" d="M12 7.6l.9 1.2 1.4-.5-.5 1.4 1.2.9-1.2.9.5 1.4-1.4-.5L12 14l-.9-1.2-1.4.5.5-1.4L9 10.6l1.2-.9-.5-1.4 1.4.5L12 7.6z"/>
        </svg>
      </div>
      <div><h1>OASIS<br><small>PRO IA</small></h1></div>
    </div>
    <nav class="nav">
      <a href="#" class="active" data-section="panel">üè† Panel</a>
      <a href="#" data-section="diagnostico">üß∞ Diagn√≥stico</a>
      <a href="#" data-section="agenda">üóìÔ∏è Agenda</a>
      <a href="#" data-section="cotizaciones">üíº Cotizaciones</a>
      <a href="#" data-section="rendimiento">üìà Rendimiento</a>
      <a href="#" data-section="datos">üóÉÔ∏è Datos / Google</a>
    </nav>
    <div class="sidebar-footer">¬© Oasis Air Cleaner Services LLC<br><span class="muted">787-664-3079 ¬∑ oasisservicespr.com</span></div>
  </aside>

  <main class="main">
    <section id="panel" class="section">
      <div class="grid">
        <div class="card">
          <h3>Diagn√≥stico T√©cnico</h3>
          <div class="row">
            <div><input id="diag-input" class="input" placeholder="S√≠ntoma o c√≥digo (E1, F0, ...)" /></div>
            <div><button class="btn" id="btn-diagnosticar">Diagnosticar</button></div>
          </div>
          <div id="diag-result"></div>
        </div>
        <div class="card">
          <div class="cal-header"><h3 style="margin:0">Agenda Inteligente</h3>
            <div class="row" style="grid-template-columns:repeat(3,auto);gap:8px">
              <button class="btn secondary" id="prev-month">‚óÄ</button>
              <div id="cal-title" style="min-width:160px;text-align:center"></div>
              <button class="btn secondary" id="next-month">‚ñ∂</button>
            </div>
          </div>
          <div class="cal-grid" id="cal-grid"></div>
          <div class="row" style="grid-template-columns:auto 1fr auto;align-items:center">
            <button class="btn" id="btn-nueva-cita">Nueva cita</button>
            <div></div>
            <button class="btn secondary" id="btn-limpiar-citas">Borrar todo</button>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="card">
          <h3>Cotizaciones</h3>
          <div class="kpis"><div class="kpi"><span class="muted">Total Mes</span><b id="kpi-total-mes">$0</b></div><div class="kpi"><span class="muted">Aprobadas</span><b id="kpi-aprobadas">0</b></div><div class="kpi"><span class="muted">Tasa √âxito</span><b id="kpi-rate">0%</b></div></div>
          <canvas id="chart-quotes" width="600" height="140"></canvas>
          <div class="list" id="lista-quotes"></div>
          <div style="margin-top:10px;display:flex;gap:8px"><button class="btn" id="btn-nueva-quote">Nueva cotizaci√≥n</button><button class="btn secondary" id="btn-limpiar-quotes" style="margin-left:auto">Borrar historial</button></div>
        </div>
        <div class="card">
          <h3>Rendimiento</h3>
          <div class="kpis"><div class="kpi"><span class="muted">Tickets Cerrados (30d)</span><b id="r2-tickets">0</b></div><div class="kpi"><span class="muted">Tiempo Prom. (h)</span><b id="r2-tiempo">0.0</b></div><div class="kpi"><span class="muted">NPS</span><b id="r2-nps">0</b></div><div class="kpi"><span class="muted">Ingresos Mes</span><b id="r2-ingresos">$0</b></div></div>
          <canvas id="chart-perf" width="600" height="140"></canvas>
        </div>
      </div>
    </section>

    <!-- (Por brevedad, el resto de secciones se mantienen igual que tu versi√≥n anterior)
         Incluye: diagn√≥stico avanzado, agenda, cotizaciones multi-√≠tem, rendimiento, datos/CRUD + configuraci√≥n Google -->
    <section id="datos" class="section hidden">
      <div class="card">
        <h3>Google Calendar</h3>
        <p class="muted">Inicia sesi√≥n y otorga permisos para crear eventos. Coloca tu <b>Client ID</b> Web y tu <b>Calendar ID</b> y pulsa conectar.</p>
        <div class="row">
          <div><label class="muted">Client ID</label><input id="cfg-client" class="input" placeholder="xxxx.apps.googleusercontent.com"></div>
          <div><label class="muted">Calendar ID</label><input id="cfg-calendar" class="input" placeholder="primary o correo@dominio.com"></div>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" id="cfg-save">Guardar</button>
          <button class="btn secondary" id="google-login">Iniciar sesi√≥n con Google</button>
          <button class="btn secondary" id="google-logout" style="margin-left:auto">Cerrar sesi√≥n</button>
        </div>
        <div id="cfg-status" class="muted" style="margin-top:8px"></div>
        <hr style="border:0;border-top:1px solid rgba(255,255,255,.12);margin:16px 0">
        <h3>C√≥digos de error (importar/exportar)</h3>
        <div style="display:flex;gap:8px">
          <button class="btn secondary" id="d-export">Exportar JSON</button>
          <label class="btn secondary"><input type="file" id="d-import" accept="application/json" style="display:none"> Importar JSON</label>
        </div>
        <div id="db-count" class="muted" style="margin-top:8px"></div>
      </div>
    </section>
  </main>
</div>

<!-- Modal y scripts reutilizados -->
<div id="modal" class="hidden" style="position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.55)">
  <div style="background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:16px; width:min(720px,92vw); padding:18px; box-shadow:var(--shadow)">
    <div style="display:flex;gap:8px;align-items:center"><h3 id="modal-title" style="margin:0">Modal</h3><div style="margin-left:auto"></div><button class="btn secondary" id="modal-close">Cerrar</button></div>
    <div id="modal-body" style="margin-top:12px"></div>
  </div>
</div>

<script>
const $ = s=>document.querySelector(s);
const $$ = s=>document.querySelectorAll(s);
const LS = { get:k=>JSON.parse(localStorage.getItem(k)||'null'), set:(k,v)=>localStorage.setItem(k, JSON.stringify(v)) };
const money = n => new Intl.NumberFormat('es-PR', {style:'currency', currency:'USD'}).format(n||0);

/* Navegaci√≥n + men√∫ m√≥vil */
$("#toggleMenu").onclick = ()=>{ const sb=$("#sidebar"); sb.style.display = getComputedStyle(sb).display==="none"?"block":"none"; };
$$(".nav a").forEach(a=>a.onclick=e=>{ e.preventDefault(); $$(".nav a").forEach(n=>n.classList.remove("active")); a.classList.add("active"); const s=a.dataset.section; $$(".section").forEach(x=>x.classList.add("hidden")); $("#"+s).classList.remove("hidden"); if(innerWidth<=1100) $("#sidebar").style.display="none"; });

/* ====== Datos base ====== */
let DB = LS.get("oasisDB") || [
  {marca:"TGM", codigo:"E1", nombre:"Error de comunicaci√≥n", sintomas:["no enciende unidad exterior","parpadeo tablero"], pasos:["Verifica cable de comunicaci√≥n","Revisa S1/S2/S3","Chequea tarjeta exterior","Resetea energ√≠a 5 min."]},
  {marca:"Midea", codigo:"F0", nombre:"Refrigerante bajo / Fuga", sintomas:["no enfr√≠a","hielo en tuber√≠a"], pasos:["Prueba de fuga 400 psi","Vac√≠o < 500 micrones","Carga por peso"]}
];
$("#db-count").textContent = `Registros en DB: ${DB.length}`;

/* ====== Diagn√≥stico m√≠nimo (panel) ====== */
function buscarDiag(q){ q=q.toLowerCase().trim(); return DB.filter(r=> r.codigo.toLowerCase()===q || r.nombre.toLowerCase().includes(q) || r.sintomas.some(s=>s.toLowerCase().includes(q))); }
$("#btn-diagnosticar").onclick = ()=>{
  const res = buscarDiag($("#diag-input").value);
  $("#diag-result").innerHTML = res.length? res.map(r=>`<div class="item" style="align-items:flex-start"><div><b>[${r.marca}] ${r.codigo}</b> ‚Äî ${r.nombre}<br><span class="muted">${r.sintomas.join(" ¬∑ ")}</span><ol style="margin:6px 0 0 18px">${r.pasos.map(p=>`<li>${p}</li>`).join("")}</ol></div></div>`).join("") : '<div class="item"><span class="muted">Sin resultados</span></div>';
};

/* ====== Agenda muy abreviada en este archivo (el completo est√° en tu versi√≥n anterior) ====== */
let citas = LS.get("oasisAppointmentsV2") || [];
const MESES=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
let calDate = new Date();
function pintarMes(date){
  const grid=$("#cal-grid"); grid.innerHTML="";
  const y=date.getFullYear(), m=date.getMonth(); $("#cal-title").textContent=`${MESES[m]} ${y}`;
  const first=new Date(y,m,1); const start=(first.getDay()+7)%7; const days=new Date(y,m+1,0).getDate();
  ["D","L","M","M","J","V","S"].forEach(n=>{ const d=document.createElement("div"); d.textContent=n; d.style.textAlign="center"; d.className="muted"; grid.appendChild(d); });
  for(let i=0;i<start;i++){ const c=document.createElement("div"); c.className="cal-cell"; grid.appendChild(c); }
  for(let d=1; d<=days; d++){ const c=document.createElement("div"); c.className="cal-cell"; const hd=document.createElement("div"); hd.className="day"; hd.textContent=d; c.appendChild(hd); const iso=new Date(y,m,d).toISOString().slice(0,10); if(citas.some(x=>x.fecha===iso)){ const dot=document.createElement("div"); dot.className="dot"; c.appendChild(dot); } c.onclick=()=>formNuevaCita(iso); grid.appendChild(c); }
}
$("#prev-month").onclick=()=>{calDate.setMonth(calDate.getMonth()-1); pintarMes(calDate);};
$("#next-month").onclick=()=>{calDate.setMonth(calDate.getMonth()+1); pintarMes(calDate);};
function formNuevaCita(defDate){
  openModal("Nueva cita",`
  <div class="row"><div><label>Fecha</label><input id="c-fecha" type="date" class="input" value="${defDate||new Date().toISOString().slice(0,10)}"></div><div><label>Inicio</label><input id="c-hora" type="time" class="input" value="09:00"></div><div><label>Fin</label><input id="c-hora-fin" type="time" class="input" value="10:00"></div></div>
  <div class="row"><div><label>Cliente</label><input id="c-cliente" class="input"></div><div><label>Servicio</label><input id="c-serv" class="input"></div></div>
  <label>Notas</label><input id="c-notas" class="input">
  <div style="display:flex;gap:8px;margin-top:10px">
    <button class="btn" id="c-save">Guardar</button>
    <button class="btn secondary" id="c-gcal">Google Calendar (URL)</button>
    <button class="btn secondary" id="c-gis">Insertar con API</button>
  </div>`, ()=>{
    $("#c-save").onclick=()=>{ const c={id:Date.now(), fecha:$("#c-fecha").value, hora:$("#c-hora").value, hora_fin:$("#c-hora-fin").value, cliente:$("#c-cliente").value, servicio:$("#c-serv").value, notas:$("#c-notas").value}; citas.push(c); LS.set("oasisAppointmentsV2", citas); pintarMes(calDate); $("#modal").classList.add("hidden"); };
    $("#c-gcal").onclick=()=>{ const c={fecha:$("#c-fecha").value, hora:$("#c-hora").value, hora_fin:$("#c-hora-fin").value, cliente:$("#c-cliente").value, servicio:$("#c-serv").value, notas:$("#c-notas").value}; window.open(gcURL(c),"_blank"); };
    $("#c-gis").onclick=async()=>{ const c={fecha:$("#c-fecha").value, hora:$("#c-hora").value, hora_fin:$("#c-hora-fin").value, cliente:$("#c-cliente").value, servicio:$("#c-serv").value, notas:$("#c-notas").value}; await insertEventGIS(c); };
  });
}
function gcURL(c){ const start=`${c.fecha}T${c.hora}:00`.replace(/[-:]/g,""); const end=`${c.fecha}T${c.hora_fin||c.hora}:00`.replace(/[-:]/g,""); const text=encodeURIComponent(`${c.servicio} ‚Äî ${c.cliente}`); const details=encodeURIComponent(c.notas||""); return `https://calendar.google.com/calendar/u/0/r/eventedit?text=${text}&dates=${start}/${end}&details=${details}`; }
$("#btn-nueva-cita").onclick=()=>formNuevaCita();

/* ====== Cotizaciones muy resumidas (lista & KPIs) ====== */
let quotes = LS.get("oasisQuotesV2") || [];
function renderQuotes(){
  const now=new Date(); const mes=now.getMonth(), ano=now.getFullYear();
  const mesArr=quotes.filter(q=> new Date(q.fecha).getMonth()===mes && new Date(q.fecha).getFullYear()===ano);
  const totalMes = mesArr.reduce((a,q)=>a+q.total,0);
  const aprobadas = mesArr.filter(q=>q.aprobada).length;
  const rate = mesArr.length? Math.round(100*aprobadas/mesArr.length):0;
  $("#kpi-total-mes").textContent=money(totalMes);
  $("#kpi-aprobadas").textContent=aprobadas;
  $("#kpi-rate").textContent=rate+"%";
  $("#lista-quotes").innerHTML = mesArr.slice().reverse().map(q=>`<div class="item"><div><b>${q.cliente}</b> ‚Äî ${q.desc}<br><span class="muted">${new Date(q.fecha).toLocaleDateString()}</span></div><div>${money(q.total)}</div></div>`).join("") || '<div class="item"><span class="muted">Sin cotizaciones</span></div>';
  const ser=Array.from({length:12}).map((_,i)=>{ const d=new Date(); d.setMonth(d.getMonth()- (11-i)); return quotes.filter(q=>{ const dq=new Date(q.fecha); return dq.getMonth()===d.getMonth() && dq.getFullYear()===d.getFullYear(); }).reduce((a,q)=>a+q.total,0); });
  drawLine($("#chart-quotes"), ser);
}
$("#btn-nueva-quote").onclick=()=>alert("Crea/edita cotizaciones en tu archivo completo (versi√≥n anterior).");
$("#btn-limpiar-quotes").onclick=()=>{ if(confirm("¬øBorrar historial?")){ quotes=[]; LS.set("oasisQuotesV2", quotes); renderQuotes(); } };

/* ====== Chart util ====== */
function drawLine(canvas, series){
  const ctx=canvas.getContext("2d"), W=canvas.width, H=canvas.height, pad=12;
  ctx.clearRect(0,0,W,H);
  const max=Math.max(...series,1), min=Math.min(...series,0);
  ctx.lineWidth=2; ctx.strokeStyle="#39a8ff";
  const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,"rgba(0,194,255,.22)"); g.addColorStop(1,"rgba(0,194,255,0)"); ctx.fillStyle=g;
  ctx.beginPath();
  series.forEach((v,i)=>{ const x=pad+i*((W-2*pad)/(series.length-1)); const y=H-pad-((v-min)/(max-min||1))*(H-2*pad); if(i===0)ctx.moveTo(x,y); else ctx.lineTo(x,y); });
  ctx.stroke(); ctx.lineTo(W-pad,H-pad); ctx.lineTo(pad,H-pad); ctx.closePath(); ctx.fill();
}

/* ====== Modal ====== */
function openModal(title, html, onMount){ $("#modal-title").textContent=title; $("#modal-body").innerHTML=html; $("#modal").classList.remove("hidden"); onMount&&onMount(); }
$("#modal-close").onclick=()=>$("#modal").classList.add("hidden");

/* ====== GIS Login + Calendar insertion ====== */
let CFG = LS.get("oasisCfg") || {clientId:"", calendarId:"primary"};
let tokenClient = null;
let accessToken = null;

function renderCfg(){ $("#cfg-client").value = CFG.clientId||""; $("#cfg-calendar").value=CFG.calendarId||"primary"; $("#cfg-status").textContent = accessToken? "Conectado ‚úîÔ∏è" : (CFG.clientId? "Client ID guardado. Pulsa Iniciar sesi√≥n." : "Sin configurar."); }
$("#cfg-save").onclick = ()=>{ CFG.clientId=$("#cfg-client").value.trim(); CFG.calendarId=$("#cfg-calendar").value.trim()||"primary"; LS.set("oasisCfg", CFG); renderCfg(); initGIS(); };
$("#google-login").onclick = async ()=>{ if(!tokenClient){ alert("Configura tu Client ID y guarda."); return; } tokenClient.requestAccessToken({prompt:"consent"}); };
$("#google-logout").onclick = ()=>{ accessToken=null; renderCfg(); alert("Sesi√≥n cerrada en la app (revoca desde myaccount.google.com si deseas)."); };

function initGIS(){
  if(!CFG.clientId) return;
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CFG.clientId,
    scope: "https://www.googleapis.com/auth/calendar.events",
    callback: (resp)=>{
      if(resp && resp.access_token){ accessToken = resp.access_token; renderCfg(); }
      else { alert("No se obtuvo token"); }
    }
  });
}
window.onload = ()=>{ pintarMes(calDate); renderQuotes(); renderCfg(); if(CFG.clientId) initGIS(); };

async function insertEventGIS(c){
  if(!accessToken){ alert("Inicia sesi√≥n con Google (Datos/Google ‚Üí Iniciar sesi√≥n)."); return; }
  const start = `${c.fecha}T${c.hora}:00-04:00`;
  const end = `${c.fecha}T${(c.hora_fin||c.hora)}:00-04:00`;
  const event = { summary:`${c.servicio} ‚Äî ${c.cliente}`, description:(c.notas||"")+" ¬∑ Oasis Pro IA", start:{dateTime:start}, end:{dateTime:end} };
  const resp = await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CFG.calendarId)}/events`, {
    method:"POST",
    headers:{ "Authorization":"Bearer "+accessToken, "Content-Type":"application/json" },
    body: JSON.stringify(event)
  });
  if(resp.ok){ alert("Evento creado en Google Calendar ‚úÖ"); } else { const t=await resp.text(); alert("Error creando evento: "+t); }
}

/* ====== Import/Export DB ====== */
$("#d-export").onclick = ()=>{ const a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([JSON.stringify(DB,null,2)],{type:"application/json"})); a.download="oasis_codigos_error.json"; a.click(); };
$("#d-import").addEventListener("change",(e)=>{ const f=e.target.files[0]; if(!f) return; const fr=new FileReader(); fr.onload=()=>{ try{ DB=JSON.parse(fr.result); LS.set("oasisDB",DB); $("#db-count").textContent = `Registros en DB: ${DB.length}`; alert("Importado"); }catch(_){ alert("JSON inv√°lido"); } }; fr.readAsText(f); });
</script>
</body>
</html>
